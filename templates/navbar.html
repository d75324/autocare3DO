{% load static %}

{% if user.is_authenticated %}
  {% if user.profile.is_mechanic %}
    <nav class="navbar navbar-expand-lg fixed-top navbar-mechanic">
  {% elif user.profile.is_particular %}
    <nav class="navbar navbar-expand-lg fixed-top navbar-particular">
  {% endif %}
{% else %}
  <nav class="navbar navbar-expand-lg fixed-top navbar-guest">
{% endif %}

  <div class="container-fluid" style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="{% if user.is_authenticated %}{% url 'profile' %}{% else %}{% url 'home' %}{% endif %}">
      <img src="{% static 'your_app/img/logoautos.png' %}" alt="AutoCare" style="height: 40px; margin-right: 0.5rem;" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
      <i class="fas fa-car" style="display: none;"></i>
      <span class="navbar-brand-text">AutoCare</span>
    </a>

    <!-- Mobile toggle button -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Navigation items -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        {% if user.is_authenticated %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'profile' %}">
              <i class="fas fa-tachometer-alt me-1"></i>
              Home
            </a>
          </li>
          <!-- Add more authenticated navigation items here -->
          {% if user.profile.is_particular %}
            <!--
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fas fa-car me-1"></i>
                Mis Vehículos
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fas fa-tools me-1"></i>
                Servicios
              </a>
            </li> -->
          {% elif user.profile.is_mechanic %}
            <!--
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fas fa-wrench me-1"></i>
                Trabajos
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <i class="fas fa-users me-1"></i>
                Clientes
              </a>
            </li> -->
          {% endif %}
        {% else %}
          <li class="nav-item">
            <a class="nav-link" href="{% url 'home' %}">
              <i class="fas fa-home me-1"></i>
              Inicio
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link smooth-scroll" href="#features">
              <i class="fas fa-star me-1"></i>
              Características
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link smooth-scroll acerca-btn" href="#benefits">
              <i class="fas fa-question-circle me-1"></i>
              ¿Por qué AutoCare?
            </a>
          </li>
        {% endif %}
      </ul>

      <!-- Right side buttons -->
      <div class="d-flex align-items-center gap-2">
        {% if user.is_authenticated %}
          <!-- Simplified user info with just logout 
          <div class="d-flex align-items-center gap-3">
            <span class="user-welcome d-none d-md-inline">
              <i class="fas fa-user-circle me-2"></i>
              {{ user.first_name|default:user.username }}
            </span> -->
            
            <!-- Logout button -->
            <form method="post" action="{% url 'logout' %}" style="margin: 0;">
              {% csrf_token %}
              <button type="submit" class="btn btn-logout">
                <i class="fas fa-sign-out-alt me-1"></i>
                <span class="d-none d-md-inline">Cerrar Sesión</span>
              </button>
            </form>
          </div>
        {% else %}
          <!-- Guest buttons -->
          <a href="{% url 'login' %}" class="btn btn-outline me-2">
            <i class="fas fa-sign-in-alt"></i>
            <span class="d-none d-md-inline ms-1">Ingresar</span>
          </a>
          <a href="{% url 'register' %}" class="btn btn-primary">
            <i class="fas fa-user-plus"></i>
            <span class="d-none d-md-inline ms-1">Registrarse</span>
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</nav>

<!-- Add some padding to the body to account for the fixed navbar -->
<style>
  body {
    padding-top: 76px;
  }
  
  /* Navbar Variants */
  .navbar-guest {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border-color);
    transition: all 0.3s ease;
  }
  
  .navbar-mechanic {
    background: rgba(108, 117, 125, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid #6c757d;
    transition: all 0.3s ease;
  }
  
  .navbar-particular {
    background: rgba(16, 185, 129, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--primary-green);
    transition: all 0.3s ease;
  }
  
  /* Navbar Brand */
  .navbar-brand {
    font-size: 1.8rem;
    font-weight: 800;
    text-decoration: none;
    gap: 0.5rem;
  }
  
  .navbar-guest .navbar-brand-text {
    color: var(--primary-green);
  }
  
  .navbar-mechanic .navbar-brand-text,
  .navbar-particular .navbar-brand-text {
    color: white;
  }
  
  /* Navbar Toggler */
  .navbar-toggler {
    border: none;
    font-size: 1.2rem;
  }
  
  .navbar-guest .navbar-toggler {
    color: var(--text-dark);
  }
  
  .navbar-mechanic .navbar-toggler,
  .navbar-particular .navbar-toggler {
    color: white;
  }
  
  /* Nav Links */
  .nav-link {
    font-weight: 500;
    position: relative;
    transition: all 0.3s ease;
    padding: 0.5rem 1rem;
  }
  
  .navbar-guest .nav-link {
    color: var(--text-dark);
  }
  
  .navbar-mechanic .nav-link,
  .navbar-particular .nav-link {
    color: rgba(255, 255, 255, 0.9);
  }
  
  /* User Welcome Text */
  .user-welcome {
    font-weight: 500;
  }
  
  .navbar-guest .user-welcome {
    color: var(--text-dark);
  }
  
  .navbar-mechanic .user-welcome,
  .navbar-particular .user-welcome {
    color: white;
  }
  
  /* Logout Button - Red theme */
  .btn-logout {
    border: 1px solid rgba(220, 38, 38, 0.3);
    background: rgba(220, 38, 38, 0.1);
    color: #DC2626;
    font-weight: 500;
    transition: all 0.3s ease;
    padding: 0.375rem 0.75rem;
    border-radius: 6px;
  }
  
  .btn-logout:hover {
    background: #DC2626;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    border-color: #DC2626;
  }
  
  /* Guest buttons */
  .btn-outline {
    color: var(--text-dark);
    border-color: var(--border-color);
    background: transparent;
  }
  
  .navbar {
    z-index: 1030;
  }
  
  .navbar.scrolled.navbar-guest {
    background: rgba(255, 255, 255, 0.98) !important;
    box-shadow: var(--shadow-lg);
  }
  
  .navbar.scrolled.navbar-mechanic {
    background: rgba(108, 117, 125, 0.98) !important;
    box-shadow: var(--shadow-lg);
  }
  
  .navbar.scrolled.navbar-particular {
    background: rgba(16, 185, 129, 0.98) !important;
    box-shadow: var(--shadow-lg);
  }
  
  .nav-link:hover {
    color: var(--primary-green) !important;
  }
  
  .navbar-mechanic .nav-link:hover,
  .navbar-particular .nav-link:hover {
    color: rgba(255, 255, 255, 1) !important;
  }
  
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    transition: all 0.3s ease;
    transform: translateX(-50%);
  }
  
  .navbar-guest .nav-link::after {
    background: var(--primary-green);
  }
  
  .navbar-mechanic .nav-link::after,
  .navbar-particular .nav-link::after {
    background: white;
  }
  
  .nav-link:hover::after {
    width: 80%;
  }
  
  .btn:hover {
    transform: translateY(-1px);
  }
  
  /* Smooth scroll */
  .smooth-scroll {
    scroll-behavior: smooth;
  }
  
  @media (max-width: 991px) {
    .navbar-nav {
      background: white;
      border-radius: 12px;
      margin-top: 1rem;
      padding: 1rem;
      box-shadow: var(--shadow-md);
    }
    
    .navbar-nav .nav-link {
      color: var(--text-dark) !important;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 0.25rem;
    }
    
    .navbar-nav .nav-link:hover {
      background-color: var(--light-green);
      color: var(--dark-green) !important;
    }
    
    .navbar-nav .nav-link::after {
      display: none;
    }
    
    .user-welcome {
      margin-bottom: 1rem;
      padding: 0.5rem 1rem;
      background: var(--light-green);
      border-radius: 8px;
      color: var(--text-dark) !important;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add scrolled class to navbar on scroll
  const navbar = document.querySelector('.navbar');
  
  window.addEventListener('scroll', () => {
    if (window.scrollY > 100) {
      navbar.classList.add('scrolled');
    } else {
      navbar.classList.remove('scrolled');
    }
  });
  
  // Close mobile menu when clicking outside
  document.addEventListener('click', function(event) {
    const navbar = document.querySelector('.navbar-collapse');
    const toggleButton = document.querySelector('.navbar-toggler');
    
    if (navbar.classList.contains('show') && 
        !navbar.contains(event.target) && 
        !toggleButton.contains(event.target)) {
      const bsCollapse = new bootstrap.Collapse(navbar, {
        toggle: false
      });
      bsCollapse.hide();
    }
  });

  // Smooth scroll for anchor links with navbar height compensation
  document.querySelectorAll('a.smooth-scroll[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        // Account for fixed navbar height
        const navbarHeight = document.querySelector('.navbar').offsetHeight;
        const targetPosition = target.offsetTop - navbarHeight - 60; // Increased offset for better visibility
        
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
        
        // Close mobile menu if open
        const navbarCollapse = document.querySelector('.navbar-collapse');
        if (navbarCollapse.classList.contains('show')) {
          const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
            toggle: false
          });
          bsCollapse.hide();
        }
      }
    });
  });

  // Specific handler for "¿Por qué AutoCare?" button with better scroll positioning
  document.querySelectorAll('.acerca-btn').forEach(button => {
    button.addEventListener('click', function(e) {
      e.preventDefault();
      const benefitsSection = document.getElementById('benefits');
      if (benefitsSection) {
        const navbarHeight = document.querySelector('.navbar').offsetHeight;
        const targetPosition = benefitsSection.offsetTop - navbarHeight - 80; // Extra space for better title visibility
        
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
        
        // Close mobile menu if open
        const navbarCollapse = document.querySelector('.navbar-collapse');
        if (navbarCollapse.classList.contains('show')) {
          const bsCollapse = new bootstrap.Collapse(navbarCollapse, {
            toggle: false
          });
          bsCollapse.hide();
        }
      }
    });
  });
});
</script>